function loadNav(){var e=document.getElementById("team_name"),t=localStorage.getItem("stored_teamname").replace(/['"]+/g,"");e.innerHTML+=t}function login(){var e=document.getElementById("username").value,t=document.getElementById("password").value;firebase.auth().signInWithEmailAndPassword(e,t).catch(function(e){alert("Incorrect username/password")}).then(function(e){db.collection("users").doc(e.uid).get().then(function(t){if(t.exists){var a=t.data();localStorage.setItem("stored_teamname",a.teamName),localStorage.setItem("uid",e.uid),window.location="home.html"}})})}function signout(){firebase.auth().signOut().then(function(){alert("Sign-out successful")}).catch(function(e){console.log("error: "+e)})}function signUp(){for(var e=document.getElementById("sign_password").value,t=document.getElementById("sign_confirmPassword").value,a=document.getElementById("sign_username").value,o=document.getElementById("sign_firstName").value,l=document.getElementById("sign_lastName").value,n=document.getElementsByName("role"),r=!1,s=0;s<n.length;s++)n[s].checked&&(r=!0);""==a||""==o||""==l||""==e||""==t?alert("All fields must be filled"):0==r?alert("Please choose your role"):e!=t&&alert("Passwords do not match"),e==t&&""!=e&&""!=t&&firebase.auth().createUserWithEmailAndPassword(a,e).catch(function(e){var t=e.code,a=e.message;"auth/weak-password"==t?alert("The password is too weak."):alert(a)}).then(function(e){if(e)return localStorage.setItem("uid",e.uid),window.location="signup_team.html",!0})}function signTeam(){var e=document.getElementById("sign_teamName").value,t=db.collection("users").doc(localStorage.getItem("uid")),a=localStorage.getItem("imgData");localStorage.removeItem("imgData"),null===a&&(a="img/team_logo.jpg"),""==e?alert("All fields must be filled"):t.get().then(function(t){db.collection("users").doc(localStorage.getItem("uid")).set({teamLogo:a,teamName:e,players:[],games:[]}).then(function(){localStorage.setItem("stored_teamname",e),localStorage.setItem("stored_teamlogo",a),window.location="index.html"}).catch(function(e){return console.error("Error writing document: ",e),!1})})}function addGame(){for(var e,t=db.collection("users").doc(localStorage.getItem("uid")),a=document.getElementsByName("optradio"),o=0;o<a.length;o++)a[o].checked&&(e=a[o].value);var l=document.getElementById("opponent").value,n=document.getElementById("date").value,r=document.getElementById("time").value,s=document.getElementById("location").value;""==l||""==n||""==r||""==s||null===e?alert("All fields must be filled"):t.get().then(function(a){if(a&&a.exists){for(var o=a.data(),d=o.games,c=o.players,i=0;i<c.length;i++)c[i].goals="0",c[i].fouls="0",c[i].yellowcards="0",c[i].redcards="0",c[i].shots="0",c[i].cornerkicks="0",c[i].goalkicks="0",c[i].penaltykicks="0",c[i].throwins="0",c[i].gamesplayed="0";var m={players:c,date:n,location:s,opponent:l,status:e,time:r};d.push(m),localStorage.setItem("stored_games",JSON.stringify(d)),t.set({teamLogo:o.teamLogo,games:d,players:o.players,teamName:localStorage.getItem("stored_teamname")}).then(function(){window.location="schedule.html"})}}).catch(function(e){console.log("error: "+e)})}function showSchedule(){db.collection("users").doc(localStorage.getItem("uid")).get().then(function(e){if(e&&e.exists){var t=e.data().games;if(0!=t.length)for(var a=0;a<t.length;a++){var o="<li><img src='img/trash.png' alt='delete' class='delete' onclick='deleteGame()'><a href='game.html' onclick='detailGame()'>"+t[a].date+" - My Team vs. "+t[a].opponent+"</a><img src='img/edit.png' alt='edit' class='edit' onclick='editGame()'></li>";document.getElementById("game_list").innerHTML+=o}else document.getElementById("no_games").innerHTML+="<br><h4>No games yet! Add a game with the + button</h4>"}}).catch(function(e){console.log("error: "+e)})}function detailGame(){var e;document.getElementsByTagName("ul")[0].onclick=function(t){for(var a=t.target;a!=document.body&&"li"!=a.tagName.toLowerCase();)a=a.parentNode;e=[].indexOf.call(a.parentNode.children,a),localStorage.setItem("index",e)}}function editGame(){var e;document.getElementsByTagName("ul")[0].onclick=function(t){for(var a=t.target;a!=document.body&&"li"!=a.tagName.toLowerCase();)a=a.parentNode;e=[].indexOf.call(a.parentNode.children,a),localStorage.setItem("index",e)},window.location="edit_game.html"}function loadEditGame(){var e=localStorage.getItem("index"),t=JSON.parse(localStorage.getItem("stored_games"));document.getElementById("opponent").value=t[e].opponent,document.getElementById("date").value=t[e].date,document.getElementById("time").value=t[e].time,document.getElementById("location").value=t[e].location,"Home"==t[e].status?document.getElementById("Home").checked=!0:document.getElementById("Away").checked=!0}function saveGame(){var e=localStorage.getItem("index"),t=JSON.parse(localStorage.getItem("stored_games")),a=db.collection("users").doc(localStorage.getItem("uid")),o=document.getElementById("opponent").value,l=document.getElementById("date").value,n=document.getElementById("time").value,r=document.getElementById("location").value;""==o||""==l||""==n||""==r?alert("All fields must be filled"):(t[e].opponent=o,t[e].date=l,t[e].time=n,t[e].location=r,1==document.getElementById("Home").checked?t[e].status="Home":t[e].status="Away",localStorage.setItem("stored_games",JSON.stringify(t)),a.get().then(function(o){if(o&&o.exists){var l=o.data();t[e].players=l.games[e].players,a.set({teamLogo:l.teamLogo,games:t,players:l.players,teamName:localStorage.getItem("stored_teamname")}).then(function(){window.location="schedule.html"})}}).catch(function(e){console.log("error: "+e)}))}function deleteGame(){var e,t,a=db.collection("users").doc(localStorage.getItem("uid")),o=document.getElementsByTagName("ul")[0];o.onclick=function(a){for(var l=a.target;l!=document.body&&"li"!=l.tagName.toLowerCase();)l=l.parentNode;e=[].indexOf.call(l.parentNode.children,l),(t=JSON.parse(localStorage.getItem("stored_games"))).splice(e,1),o.removeChild(o.children[e]),localStorage.setItem("stored_games",JSON.stringify(t))},a.get().then(function(e){if(e&&e.exists){var o=e.data();a.set({teamLogo:o.teamLogo,games:t,players:o.players,teamName:localStorage.getItem("stored_teamname")})}}).catch(function(e){console.log("error: "+e)})}function addPlayer(){var e=db.collection("users").doc(localStorage.getItem("uid")),t=document.getElementById("firstName").value,a=document.getElementById("lastName").value,o=document.getElementById("dateOfBirth").value,l=document.getElementById("jersey").value,n=document.getElementById("id_position_select").options[document.getElementById("id_position_select").selectedIndex].text,r=document.getElementById("captain").checked,s=t+" "+a,d=localStorage.getItem("imgData");if(localStorage.removeItem("imgData"),null===d&&(d="img/cat.png"),""==t||""==a||""==o||""==l||"Position"==n)return alert("All the field must be filled"),!1;var c;c=1==r?"yes":"no",e.get().then(function(r){if(r&&r.exists){var i=r.data(),m=(i.games,i.players),g={fullname:s,firstname:t,lastname:a,position:n,jersey:l,dateOfBirth:o,captain:c,profile_picture:d,goals:"0",fouls:"0",yellowcards:"0",redcards:"0",shots:"0",cornerkicks:"0",goalkicks:"0",penaltykicks:"0",throwins:"0",gamesplayed:"0"};m.push(g),localStorage.setItem("stored_players",JSON.stringify(m)),e.set({teamLogo:i.teamLogo,games:i.games,players:m,teamName:localStorage.getItem("stored_teamname")}).then(function(){window.location="players.html"})}}).catch(function(e){console.log("error: "+e)})}function showPlayer(){db.collection("users").doc(localStorage.getItem("uid")).get().then(function(e){if(e&&e.exists){var t=e.data().players;if(0!=t.length)for(var a=0;a<t.length;a++){var o="<tr><td class='headcol'><img class='player_img' src='"+t[a].profile_picture+"' alt='Player'></td><td>"+t[a].firstname+"</td><td>"+t[a].lastname+"</td><td>"+t[a].position+"</td><td><input type='button' value='Detail' class='btn btn-primary' onclick='detail_button_player(this)'></td><td><img src='img/trash.png' alt='delete' class='delete_edit_player' onclick='deletePlayer(this)'></td><td><img src='img/edit.png' alt='edit' class='delete_edit_player' onclick='edit_button_player(this)'></tr>";document.getElementById("players_list").innerHTML+=o}else document.getElementById("no_players").innerHTML+="<br><h4>No players yet! Add a player with the + button</h4>"}}).catch(function(e){console.log("error: "+e)})}function deletePlayer(e){var t=db.collection("users").doc(localStorage.getItem("uid")),a=e.parentNode.parentNode.rowIndex;a-=1;var o=JSON.parse(localStorage.getItem("stored_players"));o.splice(a,1),localStorage.setItem("stored_players",JSON.stringify(o)),document.getElementById("players_list").deleteRow(a),t.get().then(function(e){if(e&&e.exists){var a=e.data();t.set({teamLogo:a.teamLogo,games:a.games,players:o,teamName:localStorage.getItem("stored_teamname")})}}).catch(function(e){console.log("error: "+e)})}function edit_button_player(e){var t=e.parentNode.parentNode.rowIndex;t-=1,localStorage.setItem("stored_player_index",t),window.location="edit_player.html"}function edit_button_game_player(e){var t=e.parentNode.parentNode.rowIndex;t-=1,localStorage.setItem("stored_player_index",t),window.location="edit_player_stats.html"}function detail_button_player(e){var t=e.parentNode.parentNode.rowIndex;t-=1,localStorage.setItem("stored_player_index",t),window.location="player_profile.html"}function player_index(e){var t=e.parentNode.parentNode.rowIndex;t-=1,localStorage.setItem("stored_player_index",t),window.location="player_profile.html"}function loadEditPlayer(){var e=localStorage.getItem("stored_player_index"),t=JSON.parse(localStorage.getItem("stored_players"));document.getElementById("firstName").value=t[e].firstname,document.getElementById("lastName").value=t[e].lastname,document.getElementById("dateOfBirth").value=t[e].dateOfBirth,document.getElementById("jersey").value=t[e].jersey,document.getElementById("id_position_select").value=t[e].position,document.getElementById("captain").value=t[e].captain,"yes"==t[e].captain&&(document.getElementById("captain").checked=!0)}function savePlayer(){var e,t=db.collection("users").doc(localStorage.getItem("uid")),a=localStorage.getItem("stored_player_index"),o=JSON.parse(localStorage.getItem("stored_players")),l=document.getElementById("firstName").value,n=document.getElementById("lastName").value,r=document.getElementById("dateOfBirth").value,s=document.getElementById("jersey").value,d=document.getElementById("id_position_select").options[document.getElementById("id_position_select").selectedIndex].text;e=1==document.getElementById("captain").checked.checked?"yes":"no";var c=l+" "+n;if(""==l||""==n||""==r||""==s||"Position"==d)return alert("All the field must be filled"),!1;o[a].firstname=l,o[a].lastname=n,o[a].position=d,o[a].jersey=s,o[a].dateOfBirth=r,o[a].captain=e,o[a].fullname=c;var i=localStorage.getItem("imgData");localStorage.removeItem("imgData"),i!=o[a].profile_picture&&(o[a].profile_picture=i),localStorage.setItem("stored_players",JSON.stringify(o)),t.get().then(function(e){if(e&&e.exists){var a=e.data();t.set({teamLogo:a.teamLogo,games:a.games,players:o,teamName:localStorage.getItem("stored_teamname")}).then(function(){window.location="players.html"})}}).catch(function(e){console.log("error: "+e)})}function loadHome(){var e=localStorage.getItem("uid"),t=db.collection("users").doc(e);t.get().then(function(e){if(e&&e.exists){var t=e.data(),a=localStorage.getItem("stored_teamname"),o=t.teamLogo;console.log(a),document.getElementById("team_name_id").innerHTML="<h3>"+a+"</h3><img class='team_logo' src='"+o+"' alt='team'>"}}).catch(function(e){console.log("error: "+e)}),t.get().then(function(e){if(e&&e.exists){var t=e.data();localStorage.setItem("stored_games",JSON.stringify(t.games)),localStorage.setItem("stored_players",JSON.stringify(t.players)),localStorage.setItem("stored_teamname",t.teamName);var a=new Date,o=a.getMonth()+1,l=a.getDate();o<10&&(o="0"+o),l<10&&(l="0"+l);var n=t.games,r=!1;a=o+"/"+l;for(var s=0;s<n.length;s++)if(a==n[s].date){r=!0;var d=JSON.parse(JSON.stringify(n[s].date)),c=JSON.parse(JSON.stringify(n[s].time)),i=JSON.parse(JSON.stringify(n[s].location)),m=JSON.parse(JSON.stringify(n[s].opponent)),g=JSON.parse(JSON.stringify(n[s].status));document.getElementById("today_game").innerHTML=d+"<br>"+c+"<br>"+i+"<br><br>My Team vs. "+m+"<br>"+g+" Game <br>"}0==r&&(document.getElementById("today_game").innerHTML="<br><h3>No Games Today!</h3>")}}).catch(function(e){console.log("error: "+e)})}function loadPlayerProfile(){var e=JSON.parse(localStorage.getItem("stored_players")),t=localStorage.getItem("stored_player_index");document.getElementById("player_info").innerHTML="<h2><img class='player_img' src='"+e[t].profile_picture+"' alt='Temporary Player's Picture'></h2><h4>"+e[t].fullname+"</h4><h4>"+e[t].dateOfBirth+"</h4><h4>"+e[t].position+"</h4><h4> captain: "+e[t].captain+"</h4>";var a=db.collection("users").doc(localStorage.getItem("uid"));a.get().then(function(o){if(o&&o.exists){for(var l=o.data(),n=l.games,r=l.players,s=0;s<n.length;s++)n[s].players[t].fullname==e[t].fullname&&(e[t].goals=+e[t].goals+ +n[s].players[t].goals,e[t].fouls=+e[t].fouls+ +n[s].players[t].fouls,e[t].yellowcards=+e[t].yellowcards+ +n[s].players[t].yellowcards,e[t].redcards=+e[t].redcards+ +n[s].players[t].redcards,e[t].shots=+e[t].shots+ +n[s].players[t].shots,e[t].cornerkicks=+e[t].cornerkicks+ +n[s].players[t].cornerkicks,e[t].goalkicks=+e[t].goalkicks+ +n[s].players[t].goalkicks,e[t].penaltykicks=+e[t].penaltykicks+ +n[s].players[t].penaltykicks,e[t].throwins=+e[t].throwins+ +n[s].players[t].throwins,e[t].gamesplayed=+e[t].gamesplayed+ +n[s].players[t].gamesplayed);r[t]=e[t],a.set({teamLogo:l.teamLogo,games:n,players:r,teamName:localStorage.getItem("stored_teamname")}).then(function(){var a="<tr><td>"+e[t].goals+"</td><td>"+e[t].fouls+"</td><td>"+e[t].yellowcards+"</td><td>"+e[t].redcards+"</td><td>"+e[t].shots+"</td><td>"+e[t].cornerkicks+"</td><td>"+e[t].goalkicks+"</td><td>"+e[t].penaltykicks+"</td><td>"+e[t].throwins+"</td><td>"+e[t].gamesplayed+"</td></tr>";document.getElementById("player-profile-body").innerHTML=a})}}).catch(function(e){console.log("error: "+e)})}function loadEditStats(){var e=localStorage.getItem("index"),t=localStorage.getItem("stored_player_index");db.collection("users").doc(localStorage.getItem("uid")).get().then(function(a){if(a&&a.exists){var o=a.data().games;document.getElementById("player_info").innerHTML="<h2><img class='player_img' src='"+o[e].players[t].profile_picture+"' alt='Temporary Player's Picture'></h2><h4>"+o[e].players[t].fullname+"</h4><h4>"+o[e].players[t].dateOfBirth+"</h4><h4>"+o[e].players[t].position+"</h4><h4> captain: "+o[e].players[t].captain+"</h4>",document.getElementById("goals").value=o[e].players[t].goals,document.getElementById("fouls").value=o[e].players[t].fouls,document.getElementById("yellowcards").value=o[e].players[t].yellowcards,document.getElementById("redcards").value=o[e].players[t].redcards,document.getElementById("shots").value=o[e].players[t].shots,document.getElementById("cornerkicks").value=o[e].players[t].cornerkicks,document.getElementById("goalkicks").value=o[e].players[t].goalkicks,document.getElementById("penaltykicks").value=o[e].players[t].penaltykicks,document.getElementById("throwins").value=o[e].players[t].throwins,document.getElementById("gamesplayed").value=o[e].players[t].gamesplayed}}).catch(function(e){console.log("error: "+e)})}function saveEditStats(){var e=localStorage.getItem("stored_player_index"),t=localStorage.getItem("index"),a=db.collection("users").doc(localStorage.getItem("uid")),o=document.getElementById("goals").value,l=document.getElementById("fouls").value,n=document.getElementById("yellowcards").value,r=document.getElementById("redcards").value,s=document.getElementById("shots").value,d=document.getElementById("cornerkicks").value,c=document.getElementById("goalkicks").value,i=document.getElementById("penaltykicks").value,m=document.getElementById("throwins").value,g=document.getElementById("gamesplayed").value,u=JSON.parse(localStorage.getItem("stored_players"));u[e].goals=o,u[e].fouls=l,u[e].yellowcards=n,u[e].redcards=r,u[e].shots=s,u[e].cornerkicks=d,u[e].goalkicks=c,u[e].penaltykicks=i,u[e].throwins=m,u[e].gamesplayed=g,""==o||""==l||""==n||""==r||""==s||""==d||""==c||""==i||""==m||""==g?alert("All fields must be filled"):a.get().then(function(u){if(u&&u.exists){var y=u.data(),p=y.games;p[t].players[e].goals=o,p[t].players[e].fouls=l,p[t].players[e].yellowcards=n,p[t].players[e].redcards=r,p[t].players[e].shots=s,p[t].players[e].cornerkicks=d,p[t].players[e].goalkicks=c,p[t].players[e].penaltykicks=i,p[t].players[e].throwins=m,p[t].players[e].gamesplayed=g,a.set({teamLogo:y.teamLogo,games:p,players:y.players,teamName:localStorage.getItem("stored_teamname")}).then(function(){window.location="game.html"})}}).catch(function(e){console.log("error: "+e)})}function loadGame(){var e=document.getElementById("game_list"),t=db.collection("users").doc(localStorage.getItem("uid")),a=localStorage.getItem("index");t.get().then(function(e){if(e&&e.exists){var t=e.data().games;document.getElementById("game_info").innerHTML="<h4>"+t[a].date+","+t[a].time+"</h4><h4>"+t[a].location+" ("+t[a].status+")</h4><h4>My Team vs."+t[a].opponent+"</h4>"}}).catch(function(e){console.log("error: "+e)}),t.get().then(function(t){if(t&&t.exists)for(var o=t.data().games,l=0;l<o[a].players.length;l++){var n="<tr><td class='headcol'><p onclick='player_index(this)'>"+o[a].players[l].firstname+" "+o[a].players[l].lastname+"</p></td><td>"+o[a].players[l].goals+"</td><td>"+o[a].players[l].fouls+"</td><td>"+o[a].players[l].yellowcards+"</td><td>"+o[a].players[l].redcards+"</td><td>"+o[a].players[l].shots+"</td><td>"+o[a].players[l].cornerkicks+"</td><td>"+o[a].players[l].goalkicks+"</td><td>"+o[a].players[l].penaltykicks+"</td><td>"+o[a].players[l].throwins+"</td><td>"+o[a].players[l].gamesplayed+"</td><td><input type='button' value='Edit' class='btn btn-primary' onclick='edit_button_game_player(this)'></tr>";e.innerHTML+=n}}).catch(function(e){console.log("error: "+e)})}function getBase64(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){localStorage.setItem("imgData",t.result)}}function goBack(){window.history.back()}"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Service worker registration succeeded:",e)}).catch(function(e){console.log("Service worker registration failed:",e)}):console.log("Service workers are not supported.");var config={apiKey:"AIzaSyA-duDNTd4C2cNJ40JiqYglcWrSeR0n9uU",authDomain:"cse134b-hw5-52381.firebaseapp.com",databaseURL:"https://cse134b-hw5-52381.firebaseio.com",projectId:"cse134b-hw5-52381",storageBucket:"cse134b-hw5-52381.appspot.com",messagingSenderId:"641375253114"};firebase.initializeApp(config);var db=firebase.firestore();